CREATE SEQUENCE SEC_NOMINA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

--GENERAMOS LA TABLA

CREATE TABLE TRABAJADOR(NUM_SEGURO INTEGER, NOMBRE VARCHAR2(50), EDAD INTEGER, CONSTRAINT PK_SEGURO PRIMARY KEY(NUM_SEGURO));


CREATE TABLE NOMINA(ID_NOMINA INTEGER, NUM_SEGURO INTEGER, SUELDO_BASE FLOAT, HR_LABORADAS INTEGER, FECHA DATE,
CONSTRAINT PK_ID_NOMINA PRIMARY KEY(ID_NOMINA),
CONSTRAINT FK1_SEGURO FOREIGN KEY(NUM_SEGURO) REFERENCES TRABAJADOR(NUM_SEGURO));

------ SE CREA EL PROCEDIMEINTO ALMACENADO DE NOMINA -
CREATE OR REPLACE PROCEDURE GUARDAR_NOMINA(MY_ID_NOMINA OUT INTEGER,
MY_NUM_SEGURO IN INTEGER, MY_SUELDO_BASE IN INTEGER) AS
BEGIN 
SELECT SEC_NOMINA.NEXTVAL INTO MY_ID_NOMINA FROM DUAL;
INSERT INTO NOMINA(ID_NOMINA, NUM_SEGURO, SUELDO_BASE)
VALUES (MY_ID_NOMINA, MY_NUM_SEGURO, MY_SUELDO_BASE);
END;
/
------- AQUI SE LLAMAN LOS DOS PROCEDIMIENTOS ALMACENADOS -------
CREATE OR REPLACE PROCEDURE GENERAR_TRABAJADOR(MY_NUM_SEGURO IN INTEGER, MY_NOMBRE IN VARCHAR2, MY_EDAD IN INTEGER,
MY_ID_NOMINA OUT INTEGER, MY_SUELDO_BASE IN FLOAT) AS 
BEGIN
INSERT INTO TRABAJADOR VALUES(MY_NUM_SEGURO, MY_NOMBRE, MY_EDAD);
GUARDAR_NOMINA(MY_ID_NOMINA, MY_NUM_SEGURO, MY_SUELDO_BASE);
END;
/

DECLARE 
VALOR INTEGER;
BEGIN
GENERAR_TRABAJADOR(2,'MAU',26,VALOR,8000);
GENERAR_TRABAJADOR(3,'MADR',21,VALOR,9000);
GENERAR_TRABAJADOR(4,'ROCKO',20,VALOR,10000);
GENERAR_TRABAJADOR(5,'PICHI',25,VALOR,11000);
END;
/


--ESTRUCTURA DE UN CURSOR
DECLARE
CURSOR CUR_1 IS SELECT * FROM TRABAJADOR;
CURSOR CUR_2 IS SELECT * FROM NOMINA;
NOMBRE VARCHAR2(50);
EDAD INTEGER;
SUELDO_BASE FLOAT;
BEGIN
FOR GATO IN CUR_1 LOOP
FOR PERRO IN CUR_2 LOOP
IF PERRO.NUM_SEGURO=GATO.NUM_SEGURO THEN
DBMS_OUTPUT.PUT_LINE(' NOMBRE '||GATO.NOMBRE||' EDAD '||GATO.EDAD||' SUELDO '|| PERRO.SUELDO_BASE);
END IF;
END LOOP;
END LOOP;
END;
/

SET SERVEROUTPUT ON;



--CURSORES CON UPDATE !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
DECLARE
CURSOR CUR_3 IS SELECT * FROM NOMINA FOR UPDATE;
BEGIN
FOR REC IN CUR_3 LOOP
UPDATE NOMINA SET HORAS_LABORADAS=40 WHERE CURRENT OF CUR_3;
